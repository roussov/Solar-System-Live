{"ast":null,"code":"import { interval, startWith, switchMap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/planet.service\";\nimport * as i2 from \"../../services/real-ephemeris.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../planet-info-panel/planet-info-panel.component\";\nfunction SolarSystemComponent_span_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" R\\u00E9f\\u00E9rence : \", ctx_r0.lastUpdateTimestamp, \" \");\n  }\n}\nfunction SolarSystemComponent_div_36_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 47)(1, \"label\")(2, \"input\", 17);\n    i0.ɵɵlistener(\"change\", function SolarSystemComponent_div_36_Template_input_change_2_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onToggleOrbitPlanes($event.target.checked));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" Plans orbitaux visibles \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"label\")(5, \"input\", 17);\n    i0.ɵɵlistener(\"change\", function SolarSystemComponent_div_36_Template_input_change_5_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onTogglePlanetAxes($event.target.checked));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(6, \" Axes plan\\u00E9taires \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\")(8, \"input\", 17);\n    i0.ɵɵlistener(\"change\", function SolarSystemComponent_div_36_Template_input_change_8_listener($event) {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onToggleShadows($event.target.checked));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(9, \" Ombres port\\u00E9es \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", ctx_r0.showOrbitalPlanes);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"checked\", ctx_r0.showPlanetAxes);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"checked\", ctx_r0.showShadows);\n  }\n}\nfunction SolarSystemComponent_div_37_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 48)(1, \"div\", 49);\n    i0.ɵɵelement(2, \"span\", 50);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function SolarSystemComponent_div_37_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.clearFocus());\n    });\n    i0.ɵɵtext(5, \"Vue globale\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const focus_r4 = ctx.ngIf;\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"background\", focus_r4.color);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Vue centr\\u00E9e sur \", focus_r4.displayName, \" \");\n  }\n}\nfunction SolarSystemComponent_div_38_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"number\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Latence API : \", i0.ɵɵpipeBind2(2, 1, ctx_r0.metadata == null ? null : ctx_r0.metadata.responseTimeMs, \"1.0-0\"), \" ms\");\n  }\n}\nfunction SolarSystemComponent_div_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 51)(1, \"div\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, SolarSystemComponent_div_38_div_7_Template, 3, 4, \"div\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Source : \", (ctx_r0.metadata == null ? null : ctx_r0.metadata.source) || \"NASA-JPL-Horizons\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Rep\\u00E8re : \", (ctx_r0.metadata == null ? null : ctx_r0.metadata.referenceFrame) || \"J2000-ECLIPTIC\", \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"Unit\\u00E9s : \", (ctx_r0.metadata == null ? null : ctx_r0.metadata.distanceUnit) || \"AU\", \" / \", (ctx_r0.metadata == null ? null : ctx_r0.metadata.velocityUnit) || \"AU/day\", \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.metadata == null ? null : ctx_r0.metadata.responseTimeMs);\n  }\n}\nfunction SolarSystemComponent_button_40_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 52);\n    i0.ɵɵlistener(\"click\", function SolarSystemComponent_button_40_Template_button_click_0_listener() {\n      const p_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onLegendSelect(p_r6));\n    });\n    i0.ɵɵelement(1, \"span\", 53);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r6 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"active\", (ctx_r0.selectedPlanet == null ? null : ctx_r0.selectedPlanet.name) === p_r6.name || ctx_r0.focusPlanetName === p_r6.name);\n    i0.ɵɵadvance();\n    i0.ɵɵstyleProp(\"background\", p_r6.color);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", p_r6.displayName, \" \");\n  }\n}\nfunction SolarSystemComponent__svg_g_52__svg_ellipse_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelement(0, \"ellipse\", 56);\n  }\n  if (rf & 2) {\n    const p_r7 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵattribute(\"cx\", ctx_r0.centerX)(\"cy\", ctx_r0.centerY)(\"rx\", ctx_r0.getOrbitRadiusPx(p_r7))(\"ry\", ctx_r0.getOrbitRadiusPx(p_r7) * ctx_r0.orbitPlaneCompression(p_r7));\n  }\n}\nfunction SolarSystemComponent__svg_g_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"g\", 54);\n    i0.ɵɵtemplate(1, SolarSystemComponent__svg_g_52__svg_ellipse_1_Template, 1, 4, \"ellipse\", 55);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.planets);\n  }\n}\nfunction SolarSystemComponent__svg_g_53__svg_circle_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelement(0, \"circle\", 59);\n  }\n  if (rf & 2) {\n    const p_r8 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵattribute(\"cx\", ctx_r0.centerX)(\"cy\", ctx_r0.centerY)(\"r\", ctx_r0.getOrbitRadiusPx(p_r8));\n  }\n}\nfunction SolarSystemComponent__svg_g_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"g\", 57);\n    i0.ɵɵtemplate(1, SolarSystemComponent__svg_g_53__svg_circle_1_Template, 1, 3, \"circle\", 58);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.planets);\n  }\n}\nfunction SolarSystemComponent__svg_g_54__svg_ellipse_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelement(0, \"ellipse\", 62);\n  }\n  if (rf & 2) {\n    const dp_r9 = ctx.$implicit;\n    i0.ɵɵattribute(\"cx\", dp_r9.shadow == null ? null : dp_r9.shadow.cx)(\"cy\", dp_r9.shadow == null ? null : dp_r9.shadow.cy)(\"rx\", dp_r9.shadow == null ? null : dp_r9.shadow.rx)(\"ry\", dp_r9.shadow == null ? null : dp_r9.shadow.ry);\n  }\n}\nfunction SolarSystemComponent__svg_g_54_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"g\", 60);\n    i0.ɵɵtemplate(1, SolarSystemComponent__svg_g_54__svg_ellipse_1_Template, 1, 4, \"ellipse\", 61);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.displayPlanets);\n  }\n}\nfunction SolarSystemComponent__svg_g_55__svg_line_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelement(0, \"line\", 65);\n  }\n  if (rf & 2) {\n    const dp_r10 = ctx.$implicit;\n    i0.ɵɵattribute(\"x1\", dp_r10.axis == null ? null : dp_r10.axis.x1)(\"y1\", dp_r10.axis == null ? null : dp_r10.axis.y1)(\"x2\", dp_r10.axis == null ? null : dp_r10.axis.x2)(\"y2\", dp_r10.axis == null ? null : dp_r10.axis.y2);\n  }\n}\nfunction SolarSystemComponent__svg_g_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"g\", 63);\n    i0.ɵɵtemplate(1, SolarSystemComponent__svg_g_55__svg_line_1_Template, 1, 4, \"line\", 64);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.displayPlanets);\n  }\n}\nfunction SolarSystemComponent__svg_circle_57_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(0, \"circle\", 66);\n    i0.ɵɵlistener(\"click\", function SolarSystemComponent__svg_circle_57_Template_circle_click_0_listener() {\n      const dp_r12 = i0.ɵɵrestoreView(_r11).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onPlanetClick(dp_r12.planet));\n    });\n    i0.ɵɵelementStart(1, \"title\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const dp_r12 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"selected\", dp_r12.isSelected)(\"focused\", dp_r12.isFocused);\n    i0.ɵɵattribute(\"cx\", dp_r12.x)(\"cy\", dp_r12.y)(\"r\", ctx_r0.planetRadiusToPixels(dp_r12.planet))(\"fill\", dp_r12.planet.color);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(dp_r12.planet.displayName);\n  }\n}\nfunction SolarSystemComponent_div_66_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 10);\n    i0.ɵɵlistener(\"click\", function SolarSystemComponent_div_66_button_1_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.centerOnSelected());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"Centrer sur \", ctx_r0.selectedPlanet.displayName, \"\");\n  }\n}\nfunction SolarSystemComponent_div_66_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function SolarSystemComponent_div_66_button_2_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.clearFocus());\n    });\n    i0.ɵɵtext(1, \"Vue globale\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction SolarSystemComponent_div_66_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 67);\n    i0.ɵɵtemplate(1, SolarSystemComponent_div_66_button_1_Template, 2, 1, \"button\", 68)(2, SolarSystemComponent_div_66_button_2_Template, 2, 0, \"button\", 69);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.selectedPlanet);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.focusPlanetName);\n  }\n}\nfunction SolarSystemComponent_app_planet_info_panel_67_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"app-planet-info-panel\", 70);\n    i0.ɵɵlistener(\"close\", function SolarSystemComponent_app_planet_info_panel_67_Template_app_planet_info_panel_close_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.onCloseInfo());\n    });\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"planet\", ctx_r0.selectedPlanet);\n  }\n}\nfunction SolarSystemComponent_div_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 71)(1, \"p\");\n    i0.ɵɵtext(2, \" Cliquez sur une plan\\u00E8te dans la vue pour afficher ses caract\\u00E9ristiques physiques et orbitales. \");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let SolarSystemComponent = /*#__PURE__*/(() => {\n  class SolarSystemComponent {\n    constructor(planetService, ephemerisService) {\n      this.planetService = planetService;\n      this.ephemerisService = ephemerisService;\n      /**\n       * Métadonnées des 8 planètes (rayon, masse, demi-grand axe…).\n       * Fournies par PlanetService (valeurs physiques “moyennes”).\n       */\n      this.planets = [];\n      /**\n       * Planète actuellement sélectionnée (pour affichage dans PlanetInfoPanel).\n       */\n      this.selectedPlanet = null;\n      /**\n       * Données projetées sur l’écran (positions en pixels) dérivées\n       * des éphémérides réelles fournies par le backend.\n       */\n      this.displayPlanets = [];\n      /**\n       * Dimensions logiques du SVG (viewBox).\n       * Elles peuvent être ajustées sur resize pour rester responsives.\n       */\n      this.width = 800;\n      this.height = 800;\n      this.centerX = this.width / 2;\n      this.centerY = this.height / 2;\n      /**\n       * Mode de vue : 2D (vue du dessus) ou 3D (projection oblique).\n       * Ne modifie que la projection, pas les coordonnées physiques (X,Y,Z).\n       */\n      this.viewMode = '2d';\n      /**\n       * Timelapse : décalage temporel (en jours) appliqué aux éphémérides reçues.\n       * Un slider permet d’avancer/reculer d’un an, avec des pas jour/semaine/mois.\n       */\n      this.timeOffsetDays = 0;\n      this.maxTimeOffsetDays = 365;\n      this.timeStepDays = 1;\n      /**\n       * Options d’affichage avancées en vue 3D.\n       */\n      this.showOrbitalPlanes = true;\n      this.showPlanetAxes = true;\n      this.showShadows = true;\n      /**\n       * Angle de caméra utilisé en projection 3D (rotation dans le plan Y–Z).\n       */\n      this.cameraAngleRad = Math.PI / 6; // ≈ 30°\n      /**\n       * Longueur (en pixels) correspondant à 1 UA dans l’échelle radiale compressée.\n       * Affichée dans la barre d’échelle.\n       */\n      this.oneAuPixels = 0;\n      /**\n       * Valeur max du demi-grand axe (en UA) parmi les planètes.\n       * Sert de référence pour compresser l’échelle radiale (Neptune ~ max).\n       */\n      this.maxSemiMajorAxisAu = 30.1; // valeur par défaut, réajustée en ngOnInit\n      this.focusPlanetName = null;\n      /**\n       * Dernier snapshot d’éphémérides reçu (positions réelles).\n       * Permet de recalculer l’affichage sur changement de mode ou resize\n       * sans réinterroger le backend.\n       */\n      this.lastSnapshot = null;\n      this.metadata = null;\n      this.snapshotReceivedAt = null;\n      this.animationFrameId = null;\n      this.enableInertialPlayback = true;\n      this.msPerDay = 86_400_000;\n      this.latencySumMs = 0;\n      this.latencyCount = 0;\n      /**\n       * Indicateur de chargement (optionnel, au cas où tu veux l’exploiter dans le template).\n       */\n      this.isLoading = false;\n      /**\n       * Message d’erreur éventuel lors de l’appel au backend.\n       */\n      this.errorMessage = null;\n      /**\n       * Timestamp de la dernière mise à jour (vient du backend).\n       */\n      this.lastUpdateTimestamp = null;\n    }\n    // ---------------------------------------------------------------------------\n    // Cycle de vie\n    // ---------------------------------------------------------------------------\n    ngOnInit() {\n      this.planets = this.planetService.getPlanets();\n      // Détermine le plus grand demi-grand axe pour l’échelle\n      this.maxSemiMajorAxisAu = this.planets.reduce((max, p) => p.semiMajorAxisAU > max ? p.semiMajorAxisAU : max, 0) || 30.1;\n      // Initialisation des dimensions (responsive basique)\n      this.updateDimensionsFromWindow();\n      this.oneAuPixels = this.distanceToPixels(1);\n      // Mise à jour périodique des éphémérides (toutes les 60 s, avec un tir initial)\n      this.ephemerisSub = interval(60_000).pipe(startWith(0), switchMap(() => {\n        this.isLoading = true;\n        this.errorMessage = null;\n        return this.ephemerisService.getCurrentPlanetPositions();\n      })).subscribe({\n        next: snapshot => {\n          this.isLoading = false;\n          this.lastSnapshot = snapshot;\n          this.snapshotReceivedAt = Date.now();\n          this.metadata = snapshot.metadata ?? null;\n          this.lastUpdateTimestamp = snapshot.timestamp || new Date().toISOString();\n          this.trackLatency(snapshot);\n          this.updateDisplayFromSnapshot(snapshot);\n          this.startInertialAnimation();\n        },\n        error: err => {\n          this.isLoading = false;\n          console.error('Erreur éphémérides:', err);\n          this.errorMessage = 'Erreur lors de la récupération des positions réelles des planètes.';\n        }\n      });\n    }\n    ngOnDestroy() {\n      this.ephemerisSub?.unsubscribe();\n      this.stopInertialAnimation();\n    }\n    // ---------------------------------------------------------------------------\n    // Gestion de la fenêtre (responsivité)\n    // ---------------------------------------------------------------------------\n    onWindowResize() {\n      this.updateDimensionsFromWindow();\n      this.oneAuPixels = this.distanceToPixels(1);\n      // Si on a déjà des données d’éphémérides, on recalcule les positions\n      if (this.lastSnapshot) {\n        this.updateDisplayFromSnapshot(this.lastSnapshot);\n      }\n    }\n    /**\n     * Ajuste la largeur/hauteur du SVG en fonction de la taille de la fenêtre,\n     * en gardant un canvas carré centré et une marge raisonnable.\n     */\n    updateDimensionsFromWindow() {\n      const viewportWidth = window.innerWidth || 1024;\n      const maxSvg = 800;\n      // Petite marge latérale pour ne pas coller au bord de la fenêtre\n      const targetWidth = Math.min(viewportWidth - 64, maxSvg);\n      this.width = targetWidth > 320 ? targetWidth : 320;\n      this.height = this.width; // carré\n      this.centerX = this.width / 2;\n      this.centerY = this.height / 2;\n    }\n    // ---------------------------------------------------------------------------\n    // Échelle & projection\n    // ---------------------------------------------------------------------------\n    /**\n     * Conversion d’une distance en UA vers une distance en pixels,\n     * en utilisant une compression radiale (sqrt) pour garder les planètes\n     * externes visibles dans le même cadre.\n     */\n    distanceToPixels(au) {\n      if (au <= 0) {\n        return 0;\n      }\n      const maxRadiusPx = Math.min(this.width, this.height) / 2 - 40;\n      const focus = this.focusPlanetName ? this.planets.find(p => p.name === this.focusPlanetName)?.semiMajorAxisAU : undefined;\n      const effectiveMaxAu = focus ? Math.max(focus * 1.6, 0.5) : this.maxSemiMajorAxisAu;\n      const maxAu = effectiveMaxAu || 30.1;\n      // Compression radiale : sqrt(au / maxAu) * rayon_max\n      const normalized = Math.sqrt(au / maxAu);\n      return normalized * maxRadiusPx;\n    }\n    /**\n     * Rayon visuel des planètes en pixels (tres compressé pour les géantes).\n     * Ici, on reste arbitraire sur le \"style\", mais toujours déterministe.\n     */\n    planetRadiusToPixels(planet) {\n      const base = 4;\n      const scale = 0.0005;\n      return base + planet.radiusKm * scale;\n    }\n    /**\n     * Rayon visuel des orbites, basé directement sur le demi-grand axe en UA.\n     */\n    getOrbitRadiusPx(planet) {\n      return this.distanceToPixels(planet.semiMajorAxisAU);\n    }\n    /**\n     * Changement de mode de vue (2D vs 3D).\n     * On ne change que la projection, pas les données physiques.\n     */\n    setViewMode(mode) {\n      if (this.viewMode === mode) {\n        return;\n      }\n      this.viewMode = mode;\n      // Si on dispose déjà d’un snapshot, on recalcule l’affichage\n      if (this.lastSnapshot) {\n        this.updateDisplayFromSnapshot(this.lastSnapshot);\n      }\n    }\n    /**\n     * Ajuste le pas du slider (1j / 7j / 30j).\n     */\n    setTimeStep(days) {\n      this.timeStepDays = days;\n    }\n    /**\n     * Mise à jour du décalage temporel via le slider.\n     */\n    onTimeOffsetChange(event) {\n      const value = Number(event.target.value);\n      this.timeOffsetDays = Number.isFinite(value) ? value : 0;\n      this.refreshDisplay();\n    }\n    /**\n     * Réinitialise le décalage temporel (retour à l’horodatage réel).\n     */\n    resetTimeOffset() {\n      this.timeOffsetDays = 0;\n      this.refreshDisplay();\n    }\n    // ---------------------------------------------------------------------------\n    // Rendu à partir des éphémérides réelles\n    // ---------------------------------------------------------------------------\n    /**\n     * Met à jour les positions affichées à partir d’un snapshot d’éphémérides.\n     * Les coordonnées (x, y, z) sont interprétées comme héliocentriques en UA.\n     */\n    updateDisplayFromSnapshot(snapshot) {\n      if (!snapshot || !snapshot.bodies || snapshot.bodies.length === 0) {\n        this.displayPlanets = [];\n        return;\n      }\n      const positionsByName = new Map();\n      for (const body of snapshot.bodies) {\n        positionsByName.set(body.name, body);\n      }\n      const display = [];\n      const deltaDays = this.timeOffsetDays + this.computeDriftDays(snapshot);\n      for (const planet of this.planets) {\n        const pos = positionsByName.get(planet.name);\n        if (!pos) {\n          continue;\n        }\n        const {\n          x: xOrbit,\n          y: yOrbit,\n          z: zOrbitRaw\n        } = this.computePositionWithOffset(pos, planet, deltaDays);\n        let zOrbit = zOrbitRaw;\n        const baseRadiusAu = Math.sqrt(xOrbit * xOrbit + yOrbit * yOrbit + zOrbit * zOrbit) || planet.semiMajorAxisAU || 1e-6;\n        if (!this.hasVelocity(pos)) {\n          const incRad = (planet.inclinationDeg || 0) * Math.PI / 180;\n          const angle = Math.atan2(yOrbit, xOrbit);\n          const tiltRadius = Math.max(baseRadiusAu, planet.semiMajorAxisAU || baseRadiusAu);\n          zOrbit += tiltRadius * Math.sin(incRad) * Math.sin(angle);\n        }\n        const rAu = Math.sqrt(xOrbit * xOrbit + yOrbit * yOrbit + zOrbit * zOrbit) || planet.semiMajorAxisAU || 1e-6;\n        const rPx = this.distanceToPixels(rAu);\n        const scale = rPx / rAu || 1;\n        const planetRadiusPx = this.planetRadiusToPixels(planet);\n        let xScreen;\n        let yScreen;\n        if (this.viewMode === '2d') {\n          // Vue du dessus : projection dans le plan (x, y)\n          xScreen = this.centerX + xOrbit * scale;\n          yScreen = this.centerY + yOrbit * scale;\n        } else {\n          // Vue pseudo-3D : même position physique (x, y, z),\n          // projection oblique autour de l’axe X.\n          const projected = this.project3dPoint(xOrbit, yOrbit, zOrbit, scale);\n          xScreen = projected.x;\n          yScreen = projected.y;\n        }\n        // Axe planétaire (vue 3D uniquement)\n        let axis;\n        if (this.viewMode === '3d' && this.showPlanetAxes) {\n          const tiltRad = (planet.axialTiltDeg || 0) * Math.PI / 180;\n          const axisHalfPx = planetRadiusPx * 1.5;\n          const axisHalfAu = axisHalfPx / (scale || 1);\n          const axisY = Math.sin(tiltRad) * axisHalfAu;\n          const axisZ = Math.cos(tiltRad) * axisHalfAu;\n          const start = this.project3dPoint(xOrbit, yOrbit - axisY, zOrbit - axisZ, scale);\n          const end = this.project3dPoint(xOrbit, yOrbit + axisY, zOrbit + axisZ, scale);\n          axis = {\n            x1: start.x,\n            y1: start.y,\n            x2: end.x,\n            y2: end.y\n          };\n        }\n        // Ombre portée simple (ellipse aplatie sous la planète)\n        let shadow;\n        if (this.viewMode === '3d' && this.showShadows) {\n          shadow = {\n            cx: xScreen,\n            cy: yScreen + planetRadiusPx * 0.6,\n            rx: planetRadiusPx * 1.4,\n            ry: planetRadiusPx * 0.65\n          };\n        }\n        display.push({\n          planet,\n          x: xScreen,\n          y: yScreen,\n          rAu,\n          isSelected: !!this.selectedPlanet && this.selectedPlanet.name === planet.name,\n          isFocused: this.focusPlanetName === planet.name,\n          axis,\n          shadow\n        });\n      }\n      // Optionnel : recalcule l'échelle 1 UA (utile après focus)\n      this.oneAuPixels = this.distanceToPixels(1);\n      // Si on doit centrer sur une planète, calcule un décalage global\n      if (this.focusPlanetName) {\n        const focused = display.find(dp => dp.planet.name === this.focusPlanetName);\n        if (focused) {\n          const panX = this.centerX - focused.x;\n          const panY = this.centerY - focused.y;\n          this.displayPlanets = display.map(dp => ({\n            ...dp,\n            x: dp.x + panX,\n            y: dp.y + panY,\n            axis: dp.axis ? {\n              x1: dp.axis.x1 + panX,\n              y1: dp.axis.y1 + panY,\n              x2: dp.axis.x2 + panX,\n              y2: dp.axis.y2 + panY\n            } : undefined,\n            shadow: dp.shadow ? {\n              ...dp.shadow,\n              cx: dp.shadow.cx + panX,\n              cy: dp.shadow.cy + panY\n            } : undefined\n          }));\n          return;\n        }\n      }\n      this.displayPlanets = display;\n    }\n    /**\n     * Bascule des options d’affichage en vue 3D.\n     */\n    onToggleOrbitPlanes(checked) {\n      this.showOrbitalPlanes = checked;\n      this.refreshDisplay();\n    }\n    onTogglePlanetAxes(checked) {\n      this.showPlanetAxes = checked;\n      this.refreshDisplay();\n    }\n    onToggleShadows(checked) {\n      this.showShadows = checked;\n      this.refreshDisplay();\n    }\n    /**\n     * Recalcule l’affichage depuis le dernier snapshot si disponible.\n     */\n    refreshDisplay() {\n      if (this.lastSnapshot) {\n        this.updateDisplayFromSnapshot(this.lastSnapshot);\n      }\n    }\n    /**\n     * Compression visuelle des plans orbitaux en vue 3D.\n     */\n    orbitPlaneCompression(planet) {\n      const incRad = (planet.inclinationDeg || 0) * Math.PI / 180;\n      const base = Math.cos(this.cameraAngleRad);\n      const tilt = Math.cos(incRad);\n      return Math.max(0.2, base * tilt);\n    }\n    /**\n     * Projection oblique d’un point 3D (en UA) vers l’écran (px).\n     */\n    project3dPoint(xAu, yAu, zAu, scale) {\n      const x = xAu * scale;\n      const y = yAu * scale;\n      const z = zAu * scale;\n      const phi = this.cameraAngleRad;\n      const yProj = y * Math.cos(phi) - z * Math.sin(phi);\n      return {\n        x: this.centerX + x,\n        y: this.centerY + yProj\n      };\n    }\n    // ---------------------------------------------------------------------------\n    // Lecture inertielle & interpolation temporelle\n    // ---------------------------------------------------------------------------\n    onToggleInertialPlayback(checked) {\n      this.enableInertialPlayback = checked;\n      if (checked) {\n        this.startInertialAnimation();\n        this.refreshDisplay();\n      } else {\n        this.stopInertialAnimation();\n      }\n    }\n    startInertialAnimation() {\n      if (!this.enableInertialPlayback || this.animationFrameId !== null) {\n        return;\n      }\n      const tick = () => {\n        this.animationFrameId = null;\n        if (this.enableInertialPlayback) {\n          this.refreshDisplay();\n          this.animationFrameId = requestAnimationFrame(tick);\n        }\n      };\n      this.animationFrameId = requestAnimationFrame(tick);\n    }\n    stopInertialAnimation() {\n      if (this.animationFrameId !== null) {\n        cancelAnimationFrame(this.animationFrameId);\n        this.animationFrameId = null;\n      }\n    }\n    trackLatency(snapshot) {\n      const latency = snapshot.metadata?.responseTimeMs;\n      if (latency !== undefined && Number.isFinite(latency)) {\n        this.latencySumMs += latency;\n        this.latencyCount += 1;\n      }\n    }\n    computeDriftDays(snapshot) {\n      if (!this.enableInertialPlayback) {\n        return 0;\n      }\n      const refFromSnapshot = Date.parse(snapshot.timestamp);\n      const referenceMs = Number.isFinite(refFromSnapshot) ? refFromSnapshot : this.snapshotReceivedAt ?? Date.now();\n      const now = Date.now();\n      const driftMs = now - referenceMs;\n      return Math.max(0, driftMs) / this.msPerDay;\n    }\n    hasVelocity(pos) {\n      return pos.vx !== undefined && pos.vy !== undefined && pos.vz !== undefined && Number.isFinite(pos.vx) && Number.isFinite(pos.vy) && Number.isFinite(pos.vz);\n    }\n    /**\n     * Calcule la position décalée temporellement d’une planète.\n     * - Si des vitesses vx/vy/vz sont présentes, on interpole linéairement en UA.\n     * - Sinon, on retombe sur l’approximation orbitale existante (période + inclinaison).\n     */\n    computePositionWithOffset(pos, planet, deltaDays) {\n      if (deltaDays !== 0 && this.hasVelocity(pos)) {\n        return {\n          x: pos.x_au + pos.vx * deltaDays,\n          y: pos.y_au + pos.vy * deltaDays,\n          z: pos.z_au + pos.vz * deltaDays\n        };\n      }\n      if (deltaDays === 0) {\n        return {\n          x: pos.x_au,\n          y: pos.y_au,\n          z: pos.z_au\n        };\n      }\n      // Fallback : approximation orbitale simple si pas de vx/vy/vz.\n      const baseRAu = Math.sqrt(pos.x_au * pos.x_au + pos.y_au * pos.y_au + pos.z_au * pos.z_au) || planet.semiMajorAxisAU || 1e-6;\n      const orbitalPeriod = planet.orbitalPeriodDays || 365.25;\n      const baseAngle = Math.atan2(pos.y_au, pos.x_au);\n      const deltaAngle = 2 * Math.PI * deltaDays / orbitalPeriod;\n      const targetAngle = baseAngle + deltaAngle;\n      const orbitalRadiusAu = Math.max(baseRAu, planet.semiMajorAxisAU || baseRAu);\n      const incRad = (planet.inclinationDeg || 0) * Math.PI / 180;\n      return {\n        x: orbitalRadiusAu * Math.cos(targetAngle),\n        y: orbitalRadiusAu * Math.sin(targetAngle),\n        z: pos.z_au + orbitalRadiusAu * Math.sin(incRad) * Math.sin(targetAngle)\n      };\n    }\n    // ---------------------------------------------------------------------------\n    // Interaction utilisateur\n    // ---------------------------------------------------------------------------\n    /**\n     * Gestion du clic sur une planète dans le SVG.\n     */\n    onPlanetClick(planet) {\n      this.selectedPlanet = planet;\n      this.updateSelectionFlags(planet);\n    }\n    /**\n     * Gestion de la fermeture du panneau d’info.\n     */\n    onCloseInfo() {\n      this.selectedPlanet = null;\n      // Nettoie le flag de sélection visuelle\n      this.updateSelectionFlags(null);\n    }\n    /**\n     * Centre et zoome sur la planète sélectionnée.\n     */\n    centerOnSelected() {\n      if (!this.selectedPlanet) {\n        return;\n      }\n      this.focusPlanetName = this.selectedPlanet.name;\n      this.refreshDisplay();\n    }\n    clearFocus() {\n      this.focusPlanetName = null;\n      this.refreshDisplay();\n    }\n    onLegendSelect(planet) {\n      this.selectedPlanet = planet;\n      this.focusPlanetName = planet.name;\n      this.updateSelectionFlags(planet);\n      this.refreshDisplay();\n    }\n    get focusedPlanet() {\n      if (!this.focusPlanetName) {\n        return null;\n      }\n      return this.planets.find(p => p.name === this.focusPlanetName) ?? null;\n    }\n    get averageLatencyMs() {\n      if (this.latencyCount === 0) {\n        return null;\n      }\n      return this.latencySumMs / this.latencyCount;\n    }\n    updateSelectionFlags(planet) {\n      this.displayPlanets = this.displayPlanets.map(dp => ({\n        ...dp,\n        isSelected: !!planet && dp.planet.name === planet.name\n      }));\n    }\n    /**\n     * Libellé de fraîcheur des données (ex: \"< 5 min\").\n     */\n    get freshnessLabel() {\n      if (!this.lastUpdateTimestamp) {\n        return null;\n      }\n      const ts = Date.parse(this.lastUpdateTimestamp);\n      if (Number.isNaN(ts)) {\n        return null;\n      }\n      const diffMs = Date.now() - ts;\n      if (diffMs < 0) {\n        return 'à l’instant';\n      }\n      const diffMin = diffMs / 60000;\n      if (diffMin < 1) return '< 1 min';\n      if (diffMin < 5) return '< 5 min';\n      if (diffMin < 15) return '< 15 min';\n      if (diffMin < 60) return `${Math.round(diffMin)} min`;\n      const diffH = diffMin / 60;\n      if (diffH < 24) return `${diffH.toFixed(1)} h`;\n      return `${(diffH / 24).toFixed(1)} j`;\n    }\n    static {\n      this.ɵfac = function SolarSystemComponent_Factory(t) {\n        return new (t || SolarSystemComponent)(i0.ɵɵdirectiveInject(i1.PlanetService), i0.ɵɵdirectiveInject(i2.RealEphemerisService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: SolarSystemComponent,\n        selectors: [[\"app-solar-system\"]],\n        hostBindings: function SolarSystemComponent_HostBindings(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵlistener(\"resize\", function SolarSystemComponent_resize_HostBindingHandler() {\n              return ctx.onWindowResize();\n            }, false, i0.ɵɵresolveWindow);\n          }\n        },\n        decls: 69,\n        vars: 43,\n        consts: [[1, \"solar-system-layout\"], [1, \"left-pane\"], [1, \"controls-stack\"], [\"role\", \"radiogroup\", \"aria-label\", \"Mode d'affichage du syst\\u00E8me solaire\", 1, \"controls\"], [\"type\", \"button\", \"role\", \"radio\", 3, \"click\"], [\"aria-label\", \"Contr\\u00F4les de timelapse\", 1, \"timelapse-panel\"], [1, \"timelapse-row\"], [1, \"timelapse-label\"], [1, \"tag\"], [1, \"timelapse-buttons\"], [\"type\", \"button\", 3, \"click\"], [\"type\", \"button\", 1, \"ghost\", 3, \"click\"], [1, \"timelapse-slider\"], [\"type\", \"range\", \"aria-label\", \"D\\u00E9calage temporel en jours\", 3, \"input\", \"min\", \"max\", \"step\", \"value\"], [1, \"timelapse-values\"], [4, \"ngIf\"], [1, \"inertial-toggle\"], [\"type\", \"checkbox\", 3, \"change\", \"checked\"], [1, \"inertial-hint\"], [\"class\", \"view-toggles\", 4, \"ngIf\"], [\"class\", \"focus-status\", 4, \"ngIf\"], [\"class\", \"data-quality\", 4, \"ngIf\"], [1, \"color-legend\"], [\"type\", \"button\", \"class\", \"legend-item\", 3, \"active\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"role\", \"img\", \"aria-labelledby\", \"solarTitle solarDesc\", 1, \"solar-system-svg\"], [\"id\", \"solarTitle\"], [\"id\", \"solarDesc\"], [\"id\", \"sunGradient\"], [\"offset\", \"0%\", \"stop-color\", \"#ffffdd\"], [\"offset\", \"70%\", \"stop-color\", \"#ffcc33\"], [\"offset\", \"100%\", \"stop-color\", \"#dd8800\"], [\"fill\", \"url(#sunGradient)\"], [\"class\", \"orbit-planes\", 4, \"ngIf\"], [\"class\", \"orbits\", 4, \"ngIf\"], [\"class\", \"shadows\", 4, \"ngIf\"], [\"class\", \"axes\", 4, \"ngIf\"], [\"aria-label\", \"Plan\\u00E8tes du syst\\u00E8me solaire\", 1, \"planets\"], [\"class\", \"planet-circle\", 3, \"selected\", \"focused\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"scale-container\"], [1, \"scale-label\"], [\"aria-hidden\", \"true\", 1, \"scale-bar-wrapper\"], [1, \"scale-bar\"], [1, \"scale-text\"], [1, \"right-pane\"], [\"class\", \"selected-actions\", 4, \"ngIf\"], [3, \"planet\", \"close\", 4, \"ngIf\"], [\"class\", \"placeholder\", 4, \"ngIf\"], [1, \"view-toggles\"], [1, \"focus-status\"], [1, \"focus-chip\"], [1, \"focus-dot\"], [1, \"data-quality\"], [\"type\", \"button\", 1, \"legend-item\", 3, \"click\"], [1, \"legend-dot\"], [1, \"orbit-planes\"], [\"class\", \"orbit-plane\", 4, \"ngFor\", \"ngForOf\"], [1, \"orbit-plane\"], [1, \"orbits\"], [\"class\", \"orbit-circle\", 4, \"ngFor\", \"ngForOf\"], [1, \"orbit-circle\"], [1, \"shadows\"], [\"class\", \"shadow-ellipse\", 4, \"ngFor\", \"ngForOf\"], [1, \"shadow-ellipse\"], [1, \"axes\"], [\"class\", \"axis-line\", 4, \"ngFor\", \"ngForOf\"], [1, \"axis-line\"], [1, \"planet-circle\", 3, \"click\"], [1, \"selected-actions\"], [\"type\", \"button\", 3, \"click\", 4, \"ngIf\"], [\"type\", \"button\", \"class\", \"ghost\", 3, \"click\", 4, \"ngIf\"], [3, \"close\", \"planet\"], [1, \"placeholder\"]],\n        template: function SolarSystemComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_4_listener() {\n              return ctx.setViewMode(\"2d\");\n            });\n            i0.ɵɵtext(5, \" Vue 2D (vue du dessus) \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_6_listener() {\n              return ctx.setViewMode(\"3d\");\n            });\n            i0.ɵɵtext(7, \" Vue 3D (projection oblique) \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(8, \"div\", 5)(9, \"div\", 6)(10, \"div\", 7);\n            i0.ɵɵtext(11, \" Timelapse \\u00E9ph\\u00E9m\\u00E9rides \");\n            i0.ɵɵelementStart(12, \"span\", 8);\n            i0.ɵɵtext(13, \"jour / semaine / mois\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 9)(15, \"button\", 10);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_15_listener() {\n              return ctx.setTimeStep(1);\n            });\n            i0.ɵɵtext(16, \"Jour\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"button\", 10);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_17_listener() {\n              return ctx.setTimeStep(7);\n            });\n            i0.ɵɵtext(18, \"Semaine\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"button\", 10);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_19_listener() {\n              return ctx.setTimeStep(30);\n            });\n            i0.ɵɵtext(20, \"Mois\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"button\", 11);\n            i0.ɵɵlistener(\"click\", function SolarSystemComponent_Template_button_click_21_listener() {\n              return ctx.resetTimeOffset();\n            });\n            i0.ɵɵtext(22, \"R\\u00E9initialiser\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(23, \"div\", 12)(24, \"input\", 13);\n            i0.ɵɵlistener(\"input\", function SolarSystemComponent_Template_input_input_24_listener($event) {\n              return ctx.onTimeOffsetChange($event);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"div\", 14)(26, \"span\");\n            i0.ɵɵtext(27);\n            i0.ɵɵpipe(28, \"number\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(29, SolarSystemComponent_span_29_Template, 2, 1, \"span\", 15);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(30, \"div\", 16)(31, \"label\")(32, \"input\", 17);\n            i0.ɵɵlistener(\"change\", function SolarSystemComponent_Template_input_change_32_listener($event) {\n              return ctx.onToggleInertialPlayback($event.target.checked);\n            });\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(33, \" Lecture inertielle (r\\u00E9el + vx/vy/vz) \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(34, \"span\", 18);\n            i0.ɵɵtext(35);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(36, SolarSystemComponent_div_36_Template, 10, 3, \"div\", 19);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(37, SolarSystemComponent_div_37_Template, 6, 3, \"div\", 20)(38, SolarSystemComponent_div_38_Template, 8, 5, \"div\", 21);\n            i0.ɵɵelementStart(39, \"div\", 22);\n            i0.ɵɵtemplate(40, SolarSystemComponent_button_40_Template, 3, 5, \"button\", 23);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(41, \"svg\", 24)(42, \"title\", 25);\n            i0.ɵɵtext(43, \"Syst\\u00E8me solaire \\u2013 positions en temps r\\u00E9el\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(44, \"desc\", 26);\n            i0.ɵɵtext(45, \" Visualisation des 8 plan\\u00E8tes autour du Soleil. Les positions sont bas\\u00E9es sur des \\u00E9ph\\u00E9m\\u00E9rides temps r\\u00E9el fournies par le backend. \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(46, \"defs\")(47, \"radialGradient\", 27);\n            i0.ɵɵelement(48, \"stop\", 28)(49, \"stop\", 29)(50, \"stop\", 30);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(51, \"circle\", 31);\n            i0.ɵɵtemplate(52, SolarSystemComponent__svg_g_52_Template, 2, 1, \"g\", 32)(53, SolarSystemComponent__svg_g_53_Template, 2, 1, \"g\", 33)(54, SolarSystemComponent__svg_g_54_Template, 2, 1, \"g\", 34)(55, SolarSystemComponent__svg_g_55_Template, 2, 1, \"g\", 35);\n            i0.ɵɵelementStart(56, \"g\", 36);\n            i0.ɵɵtemplate(57, SolarSystemComponent__svg_circle_57_Template, 3, 9, \"circle\", 37);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(58, \"div\", 38)(59, \"div\", 39);\n            i0.ɵɵtext(60, \" \\u00C9chelle radiale (compress\\u00E9e) \\u2013 1 UA \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(61, \"div\", 40);\n            i0.ɵɵelement(62, \"div\", 41);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(63, \"div\", 42);\n            i0.ɵɵtext(64, \" 1 unit\\u00E9 astronomique \\u2248 distance moyenne Terre\\u2013Soleil (\\u2248\\u00A0149\\u00A0600\\u00A0000\\u00A0km). L\\u2019\\u00E9chelle radiale est compress\\u00E9e pour garder toutes les plan\\u00E8tes visibles. \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(65, \"div\", 43);\n            i0.ɵɵtemplate(66, SolarSystemComponent_div_66_Template, 3, 2, \"div\", 44)(67, SolarSystemComponent_app_planet_info_panel_67_Template, 1, 1, \"app-planet-info-panel\", 45)(68, SolarSystemComponent_div_68_Template, 3, 0, \"div\", 46);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"2d\");\n            i0.ɵɵattribute(\"aria-checked\", ctx.viewMode === \"2d\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.viewMode === \"3d\");\n            i0.ɵɵattribute(\"aria-checked\", ctx.viewMode === \"3d\");\n            i0.ɵɵadvance(9);\n            i0.ɵɵclassProp(\"active\", ctx.timeStepDays === 1);\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.timeStepDays === 7);\n            i0.ɵɵadvance(2);\n            i0.ɵɵclassProp(\"active\", ctx.timeStepDays === 30);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"min\", -ctx.maxTimeOffsetDays)(\"max\", ctx.maxTimeOffsetDays)(\"step\", ctx.timeStepDays)(\"value\", ctx.timeOffsetDays);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate1(\"D\\u00E9placement : \", i0.ɵɵpipeBind2(28, 40, ctx.timeOffsetDays, \"1.0-1\"), \" j\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.lastUpdateTimestamp);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"checked\", ctx.enableInertialPlayback);\n            i0.ɵɵadvance(3);\n            i0.ɵɵtextInterpolate1(\" Continue d\\u2019animer entre deux fetchs en utilisant les vitesses \", (ctx.metadata == null ? null : ctx.metadata.velocityUnit) || \"AU/j\", \". \");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.viewMode === \"3d\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.focusedPlanet);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.metadata);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.planets);\n            i0.ɵɵadvance();\n            i0.ɵɵattribute(\"width\", ctx.width)(\"height\", ctx.height)(\"viewBox\", \"0 0 \" + ctx.width + \" \" + ctx.height);\n            i0.ɵɵadvance(10);\n            i0.ɵɵattribute(\"cx\", ctx.centerX)(\"cy\", ctx.centerY)(\"r\", 15);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.viewMode === \"3d\" && ctx.showOrbitalPlanes);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.viewMode === \"2d\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.viewMode === \"3d\" && ctx.showShadows);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.viewMode === \"3d\" && ctx.showPlanetAxes);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.displayPlanets);\n            i0.ɵɵadvance(5);\n            i0.ɵɵstyleProp(\"width\", ctx.oneAuPixels, \"px\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedPlanet || ctx.focusPlanetName);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedPlanet);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.selectedPlanet);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.PlanetInfoPanelComponent, i3.DecimalPipe],\n        styles: [\"[_nghost-%COMP%]{display:block;--bg-page: #050510;--bg-panel: #050510;--bg-svg: radial-gradient(circle at center, #000015 0%, #000000 65%, #020208 100%);--border-soft: rgba(255, 255, 255, .06);--border-strong: rgba(255, 255, 255, .15);--text-main: #f5f5ff;--text-muted: #b7bbdd;--text-soft: #8a8fb8;--accent: #3b82f6;--accent-soft: rgba(59, 130, 246, .24);--accent-subtle: rgba(59, 130, 246, .1);--orbit-color: rgba(255, 255, 255, .12);--planet-stroke: rgba(255, 255, 255, .9);--shadow-strong: 0 18px 60px rgba(0, 0, 0, .9);--shadow-soft: 0 0 0 1px rgba(255, 255, 255, .02);--radius-lg: 14px;--radius-md: 10px;--radius-sm: 6px;--transition-fast: .14s ease-out;--transition-med: .2s ease;color:var(--text-main)}@keyframes _ngcontent-%COMP%_solar-fade-in{0%{opacity:0;transform:translateY(6px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes _ngcontent-%COMP%_planet-pulse{0%{transform:scale(1);filter:drop-shadow(0 0 2px rgba(255,255,255,.3))}50%{transform:scale(1.04);filter:drop-shadow(0 0 6px rgba(255,255,255,.7))}to{transform:scale(1);filter:drop-shadow(0 0 2px rgba(255,255,255,.3))}}.solar-system-layout[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:24px;width:100%;box-sizing:border-box;background:transparent}.left-pane[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;flex:1 1 auto;min-width:0}.controls-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.right-pane[_ngcontent-%COMP%]{flex:0 0 auto;min-width:260px;max-width:360px}.selected-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;margin-bottom:8px}.selected-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;border-radius:var(--radius-md);border:1px solid rgba(255,255,255,.12);background:var(--accent);color:#fff;cursor:pointer;box-shadow:0 8px 20px #3b82f659;transition:transform .1s ease,box-shadow .2s ease}.selected-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.selected-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:none}.selected-actions[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]{background:transparent;color:var(--text-soft);border-style:dashed;box-shadow:none}.selected-actions[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]:hover{color:var(--text-main);border-color:#ffffff59}.controls[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;padding:4px;border-radius:999px;background:#0a0a1ee6;box-shadow:0 10px 30px #000000b3,0 0 0 1px #ffffff0f;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);width:-moz-fit-content;width:fit-content;animation:_ngcontent-%COMP%_solar-fade-in .18s ease-out}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:relative;padding:6px 14px;border-radius:999px;border:none;background:transparent;color:var(--text-muted);font-size:13px;line-height:1;cursor:pointer;white-space:nowrap;transition:background-color var(--transition-fast),color var(--transition-fast),box-shadow var(--transition-fast),transform .08s ease-out}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:before{content:\\\"\\\";position:absolute;inset:0;border-radius:inherit;background:radial-gradient(circle at top,rgba(255,255,255,.16),transparent);opacity:0;transition:opacity var(--transition-fast);pointer-events:none}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--text-main);background:#ffffff0a}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:before{opacity:.6}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:translateY(1px) scale(.99);box-shadow:none}.controls[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:#fff;background:var(--accent);box-shadow:0 0 0 1px #ffffff2e,0 10px 25px #3b82f673}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--accent);outline-offset:2px}.timelapse-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;padding:10px 12px;border-radius:var(--radius-md);background:#0a0a1ebf;box-shadow:0 10px 30px #0000008c,0 0 0 1px #ffffff0d}.timelapse-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}.timelapse-label[_ngcontent-%COMP%]{font-size:13px;font-weight:600;letter-spacing:.03em;color:var(--text-main);display:inline-flex;align-items:center;gap:6px}.timelapse-label[_ngcontent-%COMP%]   .tag[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;background:#ffffff0f;color:var(--text-soft);font-size:11px;letter-spacing:.05em;text-transform:uppercase}.timelapse-buttons[_ngcontent-%COMP%]{display:inline-flex;gap:6px;flex-wrap:wrap}.timelapse-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;color:var(--text-muted);cursor:pointer;transition:background var(--transition-fast),color var(--transition-fast),transform .08s ease-out,box-shadow var(--transition-fast)}.timelapse-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:var(--text-main);background:#ffffff14}.timelapse-buttons[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:#fff;background:var(--accent);border-color:#ffffff2e;box-shadow:0 8px 20px #3b82f659}.timelapse-buttons[_ngcontent-%COMP%]   button.ghost[_ngcontent-%COMP%]{background:transparent;border-style:dashed}.timelapse-slider[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.timelapse-slider[_ngcontent-%COMP%]   input[type=range][_ngcontent-%COMP%]{width:100%;accent-color:var(--accent)}.timelapse-values[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;font-size:12px;color:var(--text-soft)}.inertial-toggle[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;padding:8px 10px;margin-top:2px;border-radius:var(--radius-md);background:#ffffff05;border:1px dashed rgba(255,255,255,.05);color:var(--text-soft);font-size:12px}.inertial-toggle[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;color:var(--text-main);font-weight:600}.inertial-toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--accent)}.inertial-hint[_ngcontent-%COMP%]{font-size:11px;color:var(--text-soft)}.view-toggles[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap;font-size:12px;color:var(--text-soft)}.view-toggles[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{accent-color:var(--accent)}.data-quality[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:6px;padding:10px 12px;border-radius:var(--radius-md);background:#050a19d9;border:1px solid rgba(255,255,255,.06);color:var(--text-soft);font-size:12px}.color-legend[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;font-size:12px;color:var(--text-soft)}.legend-item[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#ffffff0a;border:1px solid rgba(255,255,255,.08);color:inherit;cursor:pointer;appearance:none;-webkit-appearance:none;-moz-appearance:none;transition:border-color var(--transition-fast),transform 80ms ease-out,background var(--transition-fast),box-shadow var(--transition-fast)}.legend-item[_ngcontent-%COMP%]:hover{background:#ffffff14;color:var(--text-main);border-color:#ffffff29}.legend-item[_ngcontent-%COMP%]:active{transform:translateY(1px)}.legend-item.active[_ngcontent-%COMP%]{color:#fff;background:#3b82f640;border-color:#3b82f699;box-shadow:0 6px 16px #3b82f659}.legend-item[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--accent);outline-offset:2px}.legend-dot[_ngcontent-%COMP%]{width:10px;height:10px;border-radius:50%;border:1px solid rgba(255,255,255,.4);display:inline-block}.focus-status[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border-radius:var(--radius-md);background:linear-gradient(90deg,#3b82f629,#3b82f60d);border:1px solid rgba(59,130,246,.25);box-shadow:0 8px 20px #00000059}.focus-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:8px;font-weight:600;color:var(--text-main)}.focus-dot[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:999px;box-shadow:0 0 12px #fff6}.focus-status[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]{padding:6px 10px;border-radius:var(--radius-sm);border:1px dashed rgba(255,255,255,.35);background:transparent;color:#fff;cursor:pointer;transition:border-color var(--transition-fast),color var(--transition-fast),transform .08s ease-out}.focus-status[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]:hover{color:var(--accent);border-color:#3b82f699}.solar-system-svg[_ngcontent-%COMP%]{display:block;width:100%;max-width:800px;aspect-ratio:1 / 1;height:auto;background:var(--bg-svg);border-radius:var(--radius-lg);border:1px solid var(--border-soft);box-shadow:var(--shadow-strong),var(--shadow-soft);animation:_ngcontent-%COMP%_solar-fade-in .22s ease-out}.orbits[_ngcontent-%COMP%]{pointer-events:none}.orbit-circle[_ngcontent-%COMP%]{fill:none;stroke:var(--orbit-color);stroke-width:1;stroke-dasharray:2 4;transition:stroke var(--transition-med),stroke-width var(--transition-med)}.orbit-planes[_ngcontent-%COMP%]{pointer-events:none}.orbit-plane[_ngcontent-%COMP%]{fill:#3b82f60f;stroke:#ffffff0a;stroke-width:1;filter:blur(.4px)}.planets[_ngcontent-%COMP%]{cursor:default}.planet-circle[_ngcontent-%COMP%]{cursor:pointer;stroke:var(--planet-stroke);stroke-width:.5;transition:transform var(--transition-fast),stroke-width var(--transition-fast),filter var(--transition-fast);transform-origin:center center}.planet-circle[_ngcontent-%COMP%]:hover{stroke-width:1.1;filter:drop-shadow(0 0 4px rgba(255,255,255,.8));transform:scale(1.05)}.planet-circle[_ngcontent-%COMP%]:active{transform:scale(.98)}.planet-circle.selected[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_planet-pulse 1.2s ease-in-out infinite}.planet-circle.focused[_ngcontent-%COMP%]{stroke-width:2;filter:drop-shadow(0 0 8px rgba(250,204,21,.85))}.shadow-ellipse[_ngcontent-%COMP%]{fill:#0006;filter:blur(4px)}.axes[_ngcontent-%COMP%]{pointer-events:none}.axis-line[_ngcontent-%COMP%]{stroke:#ffffffb3;stroke-width:1.5;stroke-linecap:round;opacity:.9}.scale-container[_ngcontent-%COMP%]{margin-top:8px;font-size:12px;color:var(--text-soft);display:flex;flex-direction:column;gap:4px;max-width:420px}.scale-label[_ngcontent-%COMP%]{font-weight:500;letter-spacing:.03em;text-transform:uppercase;color:var(--text-muted)}.scale-bar-wrapper[_ngcontent-%COMP%]{position:relative;height:4px;border-radius:999px;background:#ffffff0f;overflow:hidden}.scale-bar[_ngcontent-%COMP%]{height:100%;border-radius:inherit;background:linear-gradient(90deg,var(--accent),#7dd3fc,var(--accent));box-shadow:0 0 12px #3b82f699;transform-origin:left center}.scale-bar-wrapper[_ngcontent-%COMP%]:before, .scale-bar-wrapper[_ngcontent-%COMP%]:after{content:\\\"\\\";position:absolute;top:50%;width:1px;height:8px;background:#fff6;transform:translateY(-50%)}.scale-bar-wrapper[_ngcontent-%COMP%]:before{left:0}.scale-bar-wrapper[_ngcontent-%COMP%]:after{right:0}.scale-text[_ngcontent-%COMP%]{font-style:italic;color:var(--text-soft)}@media (max-width: 1200px){.solar-system-layout[_ngcontent-%COMP%]{gap:16px}.right-pane[_ngcontent-%COMP%]{max-width:320px}}@media (max-width: 1024px){.solar-system-layout[_ngcontent-%COMP%]{flex-direction:column}.left-pane[_ngcontent-%COMP%]{order:1}.right-pane[_ngcontent-%COMP%]{order:2;max-width:100%}.solar-system-svg[_ngcontent-%COMP%]{margin-inline:auto}.scale-container[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 768px){.controls[_ngcontent-%COMP%]{padding:3px;gap:4px}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:12px;padding:5px 10px}.solar-system-svg[_ngcontent-%COMP%]{max-width:100%}}@media (max-width: 480px){.solar-system-layout[_ngcontent-%COMP%]{gap:12px}.controls[_ngcontent-%COMP%]{border-radius:var(--radius-md)}.scale-container[_ngcontent-%COMP%]{font-size:11px}}.solar-system-svg[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--accent);outline-offset:4px}button[_ngcontent-%COMP%]:focus-visible{outline:2px solid var(--accent);outline-offset:2px}\"]\n      });\n    }\n  }\n  return SolarSystemComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}