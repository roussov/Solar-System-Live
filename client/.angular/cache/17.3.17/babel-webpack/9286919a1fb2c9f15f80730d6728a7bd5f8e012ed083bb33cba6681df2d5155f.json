{"ast":null,"code":"import { map } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let RealEphemerisService = /*#__PURE__*/(() => {\n  class RealEphemerisService {\n    constructor(http) {\n      this.http = http;\n      // URL de base de l’API backend (configurable via environment)\n      this.baseUrl = environment.apiBaseUrl || 'http://localhost:3000/api/ephemeris';\n    }\n    getCurrentPlanetPositions(options) {\n      return this.http.get(`${this.baseUrl}/planets`, {\n        observe: 'response',\n        params: options?.forceRefresh ? {\n          refresh: '1'\n        } : undefined\n      }).pipe(map(response => {\n        const body = response.body;\n        const headers = response.headers;\n        const cacheStatus = headers.get('X-Horizons-Cache') ?? body?.metadata?.cacheStatus;\n        const cacheBackend = headers.get('X-Horizons-Cache-Backend') ?? body?.metadata?.cacheBackend ?? undefined;\n        const cacheAgeHeader = Number.parseInt(headers.get('X-Horizons-Cache-Age') || '', 10);\n        const ttlHeader = Number.parseInt(headers.get('X-Horizons-TTL') || '', 10);\n        const latencyHeader = Number.parseInt(headers.get('X-Horizons-Latency') || '', 10);\n        const safeCacheAge = Number.isFinite(cacheAgeHeader) ? cacheAgeHeader : body?.metadata?.cacheAgeMs;\n        const safeLatency = Number.isFinite(latencyHeader) ? latencyHeader : body?.metadata?.responseTimeMs;\n        if (!body) {\n          return {\n            timestamp: new Date().toISOString(),\n            bodies: [],\n            metadata: {\n              cacheStatus: cacheStatus,\n              cacheBackend,\n              cacheAgeMs: safeCacheAge,\n              cacheExpiresInMs: Number.isFinite(ttlHeader) ? Math.max(0, ttlHeader - (safeCacheAge || 0)) : undefined,\n              responseTimeMs: safeLatency\n            }\n          };\n        }\n        return {\n          ...body,\n          metadata: {\n            ...body.metadata,\n            cacheStatus: cacheStatus,\n            cacheBackend,\n            cacheAgeMs: safeCacheAge ?? body.metadata?.cacheAgeMs,\n            cacheExpiresInMs: Number.isFinite(ttlHeader) ? Math.max(0, ttlHeader - (safeCacheAge || 0)) : body.metadata?.cacheExpiresInMs,\n            responseTimeMs: safeLatency ?? body.metadata?.responseTimeMs\n          }\n        };\n      }));\n    }\n    static {\n      this.ɵfac = function RealEphemerisService_Factory(t) {\n        return new (t || RealEphemerisService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: RealEphemerisService,\n        factory: RealEphemerisService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return RealEphemerisService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}