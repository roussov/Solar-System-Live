{"ast":null,"code":"import { map } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let DsnService = /*#__PURE__*/(() => {\n  class DsnService {\n    constructor(http) {\n      this.http = http;\n      this.url = 'https://eyes.nasa.gov/dsn/data/dsn.xml';\n    }\n    /**\n     * Récupère l’état courant du Deep Space Network (DSN Now) et filtre\n     * uniquement les contacts utiles (VGR1/VGR2).\n     */\n    getContacts() {\n      return this.http.get(this.url, {\n        responseType: 'text'\n      }).pipe(map(xml => this.parseXml(xml)));\n    }\n    parseXml(xml) {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(xml, 'application/xml');\n      const contacts = [];\n      let currentStationName = '';\n      const children = Array.from(doc.documentElement.childNodes);\n      for (const node of children) {\n        if (node.nodeType !== Node.ELEMENT_NODE) {\n          continue;\n        }\n        const el = node;\n        if (el.tagName === 'station') {\n          currentStationName = el.getAttribute('friendlyName') || el.getAttribute('name') || '';\n        } else if (el.tagName === 'dish') {\n          const dishName = el.getAttribute('name') || '';\n          const activity = el.getAttribute('activity') || null;\n          const targets = Array.from(el.getElementsByTagName('target'));\n          for (const target of targets) {\n            const spacecraft = target.getAttribute('name') || '';\n            const spacecraftId = target.getAttribute('id') || '';\n            if (!spacecraft.toUpperCase().includes('VGR') && spacecraftId !== '31' && spacecraftId !== '32') {\n              continue;\n            }\n            const rtlt = this.parseNumber(target.getAttribute('rtlt'));\n            const range = this.parseNumber(target.getAttribute('downlegRange') ?? target.getAttribute('uplegRange'));\n            const downSignal = el.querySelector('downSignal');\n            const dataRate = this.parseNumber(downSignal?.getAttribute('dataRate'));\n            const snrDb = this.parseNumber(downSignal?.getAttribute('power'));\n            const band = downSignal?.getAttribute('band') || null;\n            contacts.push({\n              spacecraft,\n              spacecraftId,\n              station: currentStationName,\n              dish: dishName,\n              rtltSeconds: rtlt,\n              uplegRangeKm: range,\n              downlinkRate: dataRate,\n              snrDb,\n              band,\n              updatedAt: this.extractTimestamp(el),\n              activity\n            });\n          }\n        }\n      }\n      return contacts;\n    }\n    parseNumber(value) {\n      if (!value) {\n        return null;\n      }\n      const n = Number(value);\n      return Number.isFinite(n) ? n : null;\n    }\n    extractTimestamp(el) {\n      let parent = el;\n      while (parent && parent.tagName !== 'station') {\n        parent = parent.parentElement;\n      }\n      const ts = parent?.getAttribute('timeUTC');\n      if (!ts) {\n        return null;\n      }\n      const n = Number(ts);\n      if (!Number.isFinite(n)) {\n        return null;\n      }\n      return new Date(n).toISOString();\n    }\n    static {\n      this.ɵfac = function DsnService_Factory(t) {\n        return new (t || DsnService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: DsnService,\n        factory: DsnService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return DsnService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}